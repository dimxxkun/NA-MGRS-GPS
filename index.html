<!DOCTYPE html>
<html lang="en">
<head>
  <meta charset="UTF-8">
  <meta name="viewport" content="width=device-width, initial-scale=1.0">
  <title>PF - GEOTRACE</title>
  <link rel="stylesheet" href="https://unpkg.com/leaflet@1.9.4/dist/leaflet.css" />
  <style>
    body { margin: 0; font-family: Arial, sans-serif; background: #f4f4f9; }
    #map { height: 60vh; width: 100%; }
    #controls { padding: 10px; background: white; box-shadow: 0 2px 4px rgba(0,0,0,0.2); }
    .output { margin: 6px 0; padding: 6px; background: #eef; border-radius: 4px; }
    button { padding: 6px 12px; margin: 4px; border: none; border-radius: 4px; cursor: pointer; }
    button.copy { background: #007bff; color: white; }
    button.copy.copied { background: #28a745; }
  </style>
</head>
<body>
  <div id="map"></div>
  <div id="controls">
    <div class="output">MGRS: <span id="mgrsOutput"></span> <button class="copy" data-target="mgrsOutput">Copy</button></div>
    <div class="output">Lat/Long: <span id="latLonOutput"></span> <button class="copy" data-target="latLonOutput">Copy</button></div>
    <div class="output">DMS: <span id="dmsOutput"></span> <button class="copy" data-target="dmsOutput">Copy</button></div>
    <div class="output">UTM: <span id="utmOutput"></span> <button class="copy" data-target="utmOutput">Copy</button></div>
    <div class="output">Altitude (ASL): <span id="altitudeOutput"></span> <button class="copy" data-target="altitudeOutput">Copy</button></div>
    <div class="output">Height (AGL): <span id="aglOutput"></span> <button class="copy" data-target="aglOutput">Copy</button></div>
    <div class="output">Distance: <span id="distanceOutput"></span> <button class="copy" data-target="distanceOutput">Copy</button></div>
    <div class="output">Accuracy: <span id="accuracyOutput"></span> <button class="copy" data-target="accuracyOutput">Copy</button></div>
    <div class="output">Last Updated: <span id="timestampOutput"></span></div>
    <button id="copyAllBtn">Copy All Coordinates</button>
  </div>

  <script src="https://unpkg.com/leaflet@1.9.4/dist/leaflet.js"></script>
  <script src="https://unpkg.com/proj4@2.7.5/dist/proj4.js"></script>
  <script src="https://unpkg.com/mgrs@1.0.0/dist/mgrs.js"></script>
  <script>
    const map = L.map('map').setView([9.082, 8.6753], 6); // Nigeria center
    L.tileLayer('https://{s}.tile.openstreetmap.org/{z}/{x}/{y}.png', {
      maxZoom: 19,
      attribution: '© OpenStreetMap'
    }).addTo(map);

    let marker = L.marker([9.082, 8.6753], { draggable: true }).addTo(map);

    function toDMS(lat, lon) {
      function dms(deg, isLat) {
        const d = Math.floor(Math.abs(deg));
        const m = Math.floor((Math.abs(deg) - d) * 60);
        const s = ((Math.abs(deg) - d - m/60) * 3600).toFixed(2);
        const dir = deg >= 0 ? (isLat ? 'N' : 'E') : (isLat ? 'S' : 'W');
        return `${d}°${m}'${s}"${dir}`;
      }
      return `${dms(lat, true)} ${dms(lon, false)}`;
    }

    function updateOutputs(lat, lon) {
      const mgrsCoord = mgrs.forward([lon, lat], 5);
      const utm = proj4('+proj=utm +zone=32 +datum=WGS84').forward([lon, lat]);

      document.getElementById('mgrsOutput').textContent = mgrsCoord;
      document.getElementById('latLonOutput').textContent = `${lat.toFixed(6)}, ${lon.toFixed(6)}`;
      document.getElementById('dmsOutput').textContent = toDMS(lat, lon);
      document.getElementById('utmOutput').textContent = `E: ${utm[0].toFixed(2)}, N: ${utm[1].toFixed(2)}`;
      document.getElementById('altitudeOutput').textContent = "N/A";
      document.getElementById('aglOutput').textContent = "N/A";
      document.getElementById('distanceOutput').textContent = "N/A";
      document.getElementById('accuracyOutput').textContent = "N/A";
      document.getElementById('timestampOutput').textContent = new Date().toLocaleString();
    }

    updateOutputs(9.082, 8.6753);

    marker.on('dragend', (e) => {
      const { lat, lng } = e.target.getLatLng();
      updateOutputs(lat, lng);
    });

    document.querySelectorAll('button.copy').forEach(btn => {
      btn.addEventListener('click', () => {
        const targetId = btn.getAttribute('data-target');
        const text = document.getElementById(targetId).textContent;
        navigator.clipboard.writeText(text).then(() => {
          btn.classList.add('copied');
          btn.textContent = 'Copied!';
          setTimeout(() => {
            btn.classList.remove('copied');
            btn.textContent = 'Copy';
          }, 2000);
        });
      });
    });

    document.getElementById('copyAllBtn').addEventListener('click', () => {
      const outputs = [
        `MGRS: ${document.getElementById('mgrsOutput').textContent}`,
        `Lat/Long: ${document.getElementById('latLonOutput').textContent}`,
        `DMS: ${document.getElementById('dmsOutput').textContent}`,
        `UTM: ${document.getElementById('utmOutput').textContent}`,
        `Altitude (ASL): ${document.getElementById('altitudeOutput').textContent}`,
        `Height (AGL): ${document.getElementById('aglOutput').textContent}`,
        `Distance: ${document.getElementById('distanceOutput').textContent}`,
        `Accuracy: ${document.getElementById('accuracyOutput').textContent}`,
        `Last Updated: ${document.getElementById('timestampOutput').textContent}`
      ];
      const textToCopy = outputs.join('\n');
      navigator.clipboard.writeText(textToCopy).then(() => {
        const btn = document.getElementById('copyAllBtn');
        btn.classList.add('copied');
        btn.textContent = 'Copied All!';
        setTimeout(() => {
          btn.classList.remove('copied');
          btn.textContent = 'Copy All Coordinates';
        }, 2000);
      });
    });
  </script>
</body>
</html>