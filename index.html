<!DOCTYPE html>
<html lang="en">
<head>
    <meta charset="UTF-8">
    <meta name="viewport" content="width=device-width, initial-scale=1.0">
    <title>Nigerian Army GPS Coordinate System</title>
    <link href="https://cesium.com/downloads/cesiumjs/releases/1.112/Build/Cesium/Widgets/widgets.css" rel="stylesheet">
    <style>
        body {
            margin: 0;
            font-family: 'Arial', sans-serif;
            background-color: #1a2b1a;
            color: #ffffff;
            overflow: hidden;
        }
        .container {
            max-width: 1200px;
            margin: 0 auto;
            padding: 20px;
        }
        header {
            text-align: center;
            background-color: #2e4a2e;
            padding: 10px;
            border-bottom: 2px solid #4b704b;
        }
        h1 {
            margin: 0;
            font-size: 2em;
            color: #d4d4d4;
            text-transform: uppercase;
        }
        #cesiumContainer {
            height: 500px;
            border: 2px solid #4b704b;
            margin: 20px 0;
        }
        .controls {
            background-color: #2e4a2e;
            padding: 20px;
            border-radius: 5px;
            box-shadow: 0 0 10px rgba(0, 0, 0, 0.5);
        }
        .button-group {
            display: flex;
            justify-content: space-between;
            align-items: center;
            margin-bottom: 10px;
        }
        button {
            background-color: #4b704b;
            color: #ffffff;
            border: none;
            padding: 10px 20px;
            margin: 5px;
            cursor: pointer;
            font-size: 1em;
            transition: background-color 0.3s;
        }
        button:hover {
            background-color: #5a8a5a;
        }
        #selectEnemyBtn {
            background-color: #a00;
            margin-left: auto;
        }
        #selectEnemyBtn:hover {
            background-color: #c00;
        }
        .output {
            margin-top: 20px;
        }
        .output h3 {
            margin: 0 0 10px;
            color: #d4d4d4;
        }
        .output p {
            margin: 5px 0;
            font-size: 1.1em;
        }
        .output span {
            font-weight: bold;
            color: #e6e6e6;
        }
    </style>
</head>
<body>
    <div class="container">
        <header>
            <h1>Nigerian Army Coordinate System</h1>
        </header>
        <div id="cesiumContainer"></div>
        <div class="controls">
            <div class="button-group">
                <button id="getLocationBtn">Start Tracking Location</button>
                <button id="selectEnemyBtn">Select Enemy Coordinates</button>
            </div>
            <div class="output">
                <h3>Coordinates</h3>
                <p>
                    <strong>MGRS:</strong>
                    <span id="mgrsOutput">Click a button to get coordinates</span>
                </p>
                <p>
                    <strong>Lat/Long:</strong>
                    <span id="latLonOutput">Click a button to get coordinates</span>
                </p>
                <p><strong>Accuracy:</strong> <span id="accuracyOutput">N/A</span></p>
            </div>
        </div>
    </div>

    <script src="https://cesium.com/downloads/cesiumjs/releases/1.112/Build/Cesium/Cesium.js"></script>
    <script src="https://unpkg.com/proj4@2.9.0/dist/proj4.js"></script>
    <script src="https://unpkg.com/proj4-mgrs@0.1.2/dist/proj4-mgrs.js"></script>
    <script>
        // Signature: dimxxkun
        document.addEventListener('DOMContentLoaded', () => {
            // Initialize Cesium Viewer
            const viewer = new Cesium.Viewer('cesiumContainer', {
                terrainProvider: Cesium.createWorldTerrain({
                    requestWaterMask: true,
                    requestVertexNormals: true
                }),
                imageryProvider: new Cesium.TileMapServiceImageryProvider({
                    url: Cesium.buildModuleUrl('Assets/Textures/NaturalEarthII')
                }),
                baseLayer: Cesium.ImageryLayer.fromWorldImagery(),
                sceneMode: Cesium.SceneMode.SCENE3D,
                selectionIndicator: false,
                infoBox: false,
                navigationHelpButton: false,
                animation: false,
                timeline: false,
                fullscreenButton: false,
                homeButton: false,
                geocoder: false
            });

            // Set initial view to Nigeria
            viewer.camera.flyTo({
                destination: Cesium.Cartesian3.fromDegrees(7.3986, 9.0765, 1000000), // Centered on Nigeria, 1M altitude
                orientation: {
                    heading: Cesium.Math.toRadians(0.0),
                    pitch: Cesium.Math.toRadians(-30.0),
                    roll: 0.0
                }
            });

            // Marker entities
            let gpsMarker = null;
            let enemyMarker = null;

            function updateCoordinates(latitude, longitude, accuracy = null, isGps = false) {
                try {
                    const mgrs = proj4.mgrs.forward([longitude, latitude]);
                    const latLon = `Lat: ${latitude.toFixed(6)}, Lon: ${longitude.toFixed(6)}`;
                    document.getElementById('mgrsOutput').textContent = mgrs;
                    document.getElementById('latLonOutput').textContent = latLon;
                    document.getElementById('accuracyOutput').textContent = accuracy ? `Â±${accuracy.toFixed(1)} meters` : 'N/A';

                    const position = Cesium.Cartesian3.fromDegrees(longitude, latitude);
                    if (isGps) {
                        if (gpsMarker) viewer.entities.remove(gpsMarker);
                        gpsMarker = viewer.entities.add({
                            position: position,
                            billboard: {
                                image: 'https://raw.githubusercontent.com/pointhi/leaflet-color-markers/master/img/marker-icon-2x-blue.png',
                                width: 25,
                                height: 41
                            }
                        });
                    } else {
                        if (enemyMarker) viewer.entities.remove(enemyMarker);
                        enemyMarker = viewer.entities.add({
                            position: position,
                            billboard: {
                                image: 'https://raw.githubusercontent.com/pointhi/leaflet-color-markers/master/img/marker-icon-2x-red.png',
                                width: 25,
                                height: 41
                            }
                        });
                    }
                    viewer.camera.flyTo({ destination: position, orientation: { pitch: Cesium.Math.toRadians(-30.0) } });
                } catch (error) {
                    console.error('MGRS conversion error:', error);
                }
            }

            // Tracking button
            const getLocationBtn = document.getElementById('getLocationBtn');
            let watchId = null;
            let isTracking = false;

            function updateButtonText() {
                getLocationBtn.textContent = isTracking ? 'Stop Tracking Location' : 'Start Tracking Location';
            }

            getLocationBtn.addEventListener('click', () => {
                if (!navigator.geolocation) {
                    alert('Geolocation not supported.');
                    return;
                }
                if (isTracking) {
                    if (watchId) navigator.geolocation.clearWatch(watchId);
                    watchId = null;
                    isTracking = false;
                    updateButtonText();
                } else {
                    watchId = navigator.geolocation.watchPosition(
                        pos => updateCoordinates(pos.coords.latitude, pos.coords.longitude, pos.coords.accuracy, true),
                        err => { alert('Location error: ' + err.message); isTracking = false; updateButtonText(); },
                        { enableHighAccuracy: true, timeout: 10000, maximumAge: 0 }
                    );
                    isTracking = true;
                    updateButtonText();
                }
            });

            // Enemy coordinates selection
            document.getElementById('selectEnemyBtn').addEventListener('click', () => {
                if (isTracking && watchId) {
                    navigator.geolocation.clearWatch(watchId);
                    watchId = null;
                    isTracking = false;
                    updateButtonText();
                }
                viewer.screenSpaceEventHandler.setInputAction(function (click) {
                    const cartesian = viewer.camera.pickEllipsoid(click.position, viewer.scene.globe.ellipsoid);
                    if (cartesian) {
                        const cartographic = Cesium.Cartographic.fromCartesian(cartesian);
                        const longitude = Cesium.Math.toDegrees(cartographic.longitude);
                        const latitude = Cesium.Math.toDegrees(cartographic.latitude);
                        updateCoordinates(latitude, longitude, null, false);
                        viewer.screenSpaceEventHandler.removeInputAction(Cesium.ScreenSpaceEventType.LEFT_CLICK);
                    }
                }, Cesium.ScreenSpaceEventType.LEFT_CLICK);
                alert('Click the map to select enemy coordinates.');
            });

            // GPS zoom control
            const gpsControl = document.createElement('div');
            gpsControl.innerHTML = 'ðŸ“';
            gpsControl.title = 'Zoom to your GPS location';
            Object.assign(gpsControl.style, {
                backgroundColor: '#4b704b',
                width: '34px',
                height: '34px',
                display: 'flex',
                justifyContent: 'center',
                alignItems: 'center',
                cursor: 'pointer',
                fontSize: '18px',
                color: 'white',
                position: 'absolute',
                top: '20px',
                left: '20px'
            });
            gpsControl.onclick = () => {
                if (navigator.geolocation) {
                    navigator.geolocation.getCurrentPosition(
                        pos => {
                            const position = Cesium.Cartesian3.fromDegrees(pos.coords.longitude, pos.coords.latitude, 50000); // 50km altitude
                            viewer.camera.flyTo({ destination: position, orientation: { pitch: Cesium.Math.toRadians(-30.0) } });
                            updateCoordinates(pos.coords.latitude, pos.coords.longitude, pos.coords.accuracy, true);
                        },
                        err => alert('Unable to access GPS: ' + err.message)
                    );
                }
            };
            document.getElementById('cesiumContainer').appendChild(gpsControl);
        });
    </script>
</body>
</html>